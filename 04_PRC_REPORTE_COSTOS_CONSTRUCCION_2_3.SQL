/**********************************************************************      
$Archive  : PRC_REPORTE_COSTOS_CONSTRUCCION.sql
$Revision : $      
$Author   : CAD      
$Modtime  : $       
$History  : $   Metodo de Reposicion (MR)   
**********************************************************************/  

/*
SET SERVEROUTPUT ON;
CLEAR SCREEN;
VARIABLE emp_data REFCURSOR;
--EXECUTE PRC_REPORTE_COSTOS_CONSTRUCCION_2_3('004580', '11', '01', '000', '00000', :emp_data);;
EXECUTE PRC_REPORTE_COSTOS_CONSTRUCCION_2_3('004580', null, null, null, null, :emp_data);
PRINT :emp_data;

 select uso_prevalente_f ('004110','01','06','002','00000',null,null,null) from dual
*/


CREATE OR REPLACE PROCEDURE PRC_REPORTE_COSTOS_CONSTRUCCION_2_3 
(
    p_barrio        IN VARCHAR2,
    p_manzana       IN VARCHAR2,
    p_predio        IN VARCHAR2,
    p_construccion  IN VARCHAR2,
    p_resto         IN VARCHAR2,
    p_resultado     OUT SYS_REFCURSOR
)
IS
BEGIN
    OPEN p_resultado FOR

    SELECT 
        v.CODIGO_BARRIO, v.CODIGO_MANZANA, v.CODIGO_PREDIO, v.CODIGO_CONSTRUCCION, v.CODIGO_RESTO,pr.CHIP,v.CODIGO_USO, v.UNIDAD_CALIFICADA, v.AREA_USO, 
        v.FECHA_CALIFICACION, v.ANO_CONSTRUCCION, v.PUNTAJE, v.PISOS, c.MAX_NUM_PISOS, v.AVANCE_CONSTRUCCION, v.NOMBRE_RESPONSABLE, v.IDENTIFICACION_RESPONSABLE, v.VALOR_UNIT_CONSTRUCCION, 

        v.ARMAZON_ESTRUCTURA,
		CASE 
		  WHEN ((uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
				(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
				(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR
				(uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR 
				(cu.GRUPO_USO_PRESUPUESTO IS NULL))  THEN                 
				CASE 
				WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
					SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
					FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
					INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
					INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
					WHERE CF.CODIGO_FICHA = v.ARMAZON_ESTRUCTURA
				)
				WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
					SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
					FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
					INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
					INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
					WHERE CF.CODIGO_FICHA = v.ARMAZON_ESTRUCTURA
				)
				ELSE 0
			END
		ELSE
				CASE 
				WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
					SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
					FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
					INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
					INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
					WHERE CF.CODIGO_FICHA = v.ARMAZON_ESTRUCTURA
				)
				WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
					SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
					FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
					INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
					INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
					WHERE CF.CODIGO_FICHA = v.ARMAZON_ESTRUCTURA
				)
				ELSE 0
			END
		END AS TOTAL_ARMAZON_ESTRUCTURA,		

		v.MUROS_ESTRUCTURA,
		CASE 
		  WHEN ((uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
				(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
				(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR
				(uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR 
				(cu.GRUPO_USO_PRESUPUESTO IS NULL))  THEN                 
				CASE 
				WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
					SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
					FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
					INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
					INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
					WHERE CF.CODIGO_FICHA = v.MUROS_ESTRUCTURA
				)
				WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
					SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
					FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
					INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
					INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
					WHERE CF.CODIGO_FICHA = v.MUROS_ESTRUCTURA
				)
				ELSE 0
			END
		ELSE
				CASE 
				WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
					SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
					FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
					INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
					INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
					WHERE CF.CODIGO_FICHA = v.MUROS_ESTRUCTURA
				)
				WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
					SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
					FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
					INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
					INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
					WHERE CF.CODIGO_FICHA = v.MUROS_ESTRUCTURA
				)
				ELSE 0
			END
		END AS  TOTAL_MUROS_ESTRUCTURA,
        
		v.CUBIERTA_ESTRUCTURA,
		CASE 
		  WHEN 
		  (
				(uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
				(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
				(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR
				(uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR 
				(cu.GRUPO_USO_PRESUPUESTO IS NULL)
		  )  THEN                 
				CASE 
				WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
					SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
					FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
					INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
					INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
					WHERE CF.CODIGO_FICHA = v.CUBIERTA_ESTRUCTURA
				)
				WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
					SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
					FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
					INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
					INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
					WHERE CF.CODIGO_FICHA = v.CUBIERTA_ESTRUCTURA
				)
				ELSE 0
			END
		ELSE
				CASE 
				WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
					SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
					FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
					INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
					INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
					WHERE CF.CODIGO_FICHA = v.CUBIERTA_ESTRUCTURA
				)
				WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
					SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
					FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
					INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
					INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
					WHERE CF.CODIGO_FICHA = v.CUBIERTA_ESTRUCTURA
				)
				ELSE 0
			END
		END AS  TOTAL_CUBIERTA_ESTRUCTURA,
  
		v.CONSERVACION_ESTRUCTURA,
		CASE 
		  WHEN 
		  (
			(uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
			(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
			(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR
			(uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR
			(cu.GRUPO_USO_PRESUPUESTO IS NULL)
		  )
		  THEN                 
			CASE 
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CONSERVACION_ESTRUCTURA
				)
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CONSERVACION_ESTRUCTURA
				)
			  ELSE 0
			END
		ELSE
			CASE 
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CONSERVACION_ESTRUCTURA
				)
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CONSERVACION_ESTRUCTURA
				)
			  ELSE 0
			END
		END AS TOTAL_CONSERVACION_ESTRUCTURA,
	
		v.FACHADA_ACABADOS,
		CASE 
		  WHEN 
		  (
			(uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
			(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
			(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR
			(uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR
			(cu.GRUPO_USO_PRESUPUESTO IS NULL)
		  )
		  THEN                 
			CASE 
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.FACHADA_ACABADOS
				)
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.FACHADA_ACABADOS
				)
			  ELSE 0
			END
		  ELSE
			CASE 
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.FACHADA_ACABADOS
				)
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.FACHADA_ACABADOS
				)
			  ELSE 0
			END
		END AS TOTAL_FACHADA_ACABADOS,
        
		v.CUBIERTA_MUROS_ACABADOS,
		CASE 
		  WHEN 
		  (
			(uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
			(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
			(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR
			(uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR
			(cu.GRUPO_USO_PRESUPUESTO IS NULL)
		  )
		  THEN                 
			CASE 
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CUBIERTA_MUROS_ACABADOS
				)
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CUBIERTA_MUROS_ACABADOS
				)
			  ELSE 0
			END
		  ELSE
			CASE 
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CUBIERTA_MUROS_ACABADOS
				)
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CUBIERTA_MUROS_ACABADOS
				)
			  ELSE 0
			END
		END AS TOTAL_CUBIERTA_MUROS_ACABADOS,
        
		v.PISOS_ACABADOS,
		CASE 
		  WHEN 
		  (
			(uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
			(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
			(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR
			(uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR
			(cu.GRUPO_USO_PRESUPUESTO IS NULL)
		  )
		  THEN                 
			CASE 
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.PISOS_ACABADOS
				)
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.PISOS_ACABADOS
				)
			  ELSE 0
			END
		  ELSE
			CASE 
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.PISOS_ACABADOS
				)
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.PISOS_ACABADOS
				)
			  ELSE 0
			END
		END AS TOTAL_PISOS_ACABADOS,
        
		v.CONSERVACION_ACABADOS,
		CASE 
		  WHEN 
		  (
			(uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
			(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
			(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR
			(uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR
			(cu.GRUPO_USO_PRESUPUESTO IS NULL)
		  )
		  THEN                 
			CASE 
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CONSERVACION_ACABADOS
				)
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CONSERVACION_ACABADOS
				)
			  ELSE 0
			END
		  ELSE
			CASE 
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CONSERVACION_ACABADOS
				)
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CONSERVACION_ACABADOS
				)
			  ELSE 0
			END
		END AS TOTAL_CONSERVACION_ACABADOS,
        
		v.TAMANO_BANO,
		CASE 
		  WHEN 
		  (
			(uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
			(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
			(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR
			(uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR
			(cu.GRUPO_USO_PRESUPUESTO IS NULL)
		  )
		  THEN                 
			CASE 
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.TAMANO_BANO
				)
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.TAMANO_BANO
				)
			  ELSE 0
			END
		  ELSE
			CASE 
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.TAMANO_BANO
				)
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.TAMANO_BANO
				)
			  ELSE 0
			END
		END AS TOTAL_TAMANO_BANO,
        
		v.ENCHAPE_BANO,
		CASE 
		  WHEN 
		  (
			(uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
			(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
			(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR
			(uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR
			(cu.GRUPO_USO_PRESUPUESTO IS NULL)
		  )
		  THEN                 
			CASE 
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.ENCHAPE_BANO
				)
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.ENCHAPE_BANO
				)
			  ELSE 0
			END
		  ELSE
			CASE 
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.ENCHAPE_BANO
				)
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.ENCHAPE_BANO
				)
			  ELSE 0
			END
		END AS TOTAL_ENCHAPE_BANO,
        
		v.MOBILIARIO_BANO,
		CASE 
		  WHEN 
		  (
			(uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
			(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
			(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR
			(uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR
			(cu.GRUPO_USO_PRESUPUESTO IS NULL)
		  )
		  THEN                 
			CASE 
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.MOBILIARIO_BANO
				)
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.MOBILIARIO_BANO
				)
			  ELSE 0
			END
		  ELSE
			CASE 
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.MOBILIARIO_BANO
				)
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.MOBILIARIO_BANO
				)
			  ELSE 0
			END
		END AS TOTAL_MOBILIARIO_BANO,
			
		CONSERVACION_BANO,
		CASE 
		  WHEN 
		  (
			(uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
			(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
			(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR
			(uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR
			(cu.GRUPO_USO_PRESUPUESTO IS NULL)
		  )
		  THEN                 
			CASE 
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CONSERVACION_BANO
				)
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CONSERVACION_BANO
				)
			  ELSE 0
			END
		  ELSE
			CASE 
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CONSERVACION_BANO
				)
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CONSERVACION_BANO
				)
			  ELSE 0
			END
		END AS TOTAL_CONSERVACION_BANO,
        
		v.TAMANO_COCINA,
		CASE 
		  WHEN 
		  (
			(uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
			(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
			(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR
			(uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR
			(cu.GRUPO_USO_PRESUPUESTO IS NULL)
		  )
		  THEN                 
			CASE 
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.TAMANO_COCINA
				)
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.TAMANO_COCINA
				)
			  ELSE 0
			END
		  ELSE
			CASE 
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.TAMANO_COCINA
				)
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.TAMANO_COCINA
				)
			  ELSE 0
			END
		END AS TOTAL_TAMANO_COCINA,
        
		v.ENCHAPE_COCINA,
		CASE 
		  WHEN 
		  (
			(uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
			(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
			(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR
			(uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR
			(cu.GRUPO_USO_PRESUPUESTO IS NULL)
		  )
		  THEN                 
			CASE 
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.ENCHAPE_COCINA
				)
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.ENCHAPE_COCINA
				)
			  ELSE 0
			END
		  ELSE
			CASE 
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.ENCHAPE_COCINA
				)
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.ENCHAPE_COCINA
				)
			  ELSE 0
			END
		END AS TOTAL_ENCHAPE_COCINA,
        
		v.MOBILIARIO_COCINA,
		CASE 
		  WHEN 
		  (
			(uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
			(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
			(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR (uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR
			(cu.GRUPO_USO_PRESUPUESTO IS NULL)
		  )
		  THEN                 
			CASE 
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.MOBILIARIO_COCINA
				)
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.MOBILIARIO_COCINA
				)
			  ELSE 0
			END
		  ELSE
			CASE 
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.MOBILIARIO_COCINA
				)
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.MOBILIARIO_COCINA
				)
			  ELSE 0
			END
		END AS TOTAL_MOBILIARIO_COCINA,
        
		v.CONSERVACION_COCINA,
		CASE 
		  WHEN 
		  (
			(uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
			(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
			(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR 
			(uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR
			(cu.GRUPO_USO_PRESUPUESTO IS NULL)
		  )
		  THEN                 
			CASE 
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CONSERVACION_COCINA
				)
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CONSERVACION_COCINA
				)
			  ELSE 0
			END
		  ELSE
			CASE 
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CONSERVACION_COCINA
				)
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.CONSERVACION_COCINA
				)
			  ELSE 0
			END
		END AS TOTAL_CONSERVACION_COCINA,
        
		v.COMPLEMENTO_INDUSTRIA,
		CASE 
		  WHEN 
		  (
			(uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
			(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
			(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR
			(uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR
			(cu.GRUPO_USO_PRESUPUESTO IS NULL)
		  )
		  THEN                 
			CASE 
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.COMPLEMENTO_INDUSTRIA
				)
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.COMPLEMENTO_INDUSTRIA
				)
			  ELSE 0
			END
		  ELSE
			CASE 
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.COMPLEMENTO_INDUSTRIA
				)
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.COMPLEMENTO_INDUSTRIA
				)
			  ELSE 0
			END
		END AS TOTAL_COMPLEMENTO_INDUSTRIA,
        
		v.ALTURA_CERCHAS,
		CASE 
		  WHEN 
		  (
			(uc.TIENE_USO_ESPECIAL = 1 AND v.ARMAZON_ESTRUCTURA IN ('111', '112')) OR
			(uc.TIENE_USO_012 = 1 AND (uc.MAX_AREA_USO_012 > 350 OR c.MAX_NUM_PISOS > 5) AND 
			(cu.GRUPO_USO_PRESUPUESTO IS NULL OR G.GRUPO_USO_PRESUPUESTO <> cu.GRUPO_USO_PRESUPUESTO)) OR
			(uc.TIENE_USO_020 = 1 AND uc.CLASE_CONSTRUCCION_020 = 'C') OR
			(cu.GRUPO_USO_PRESUPUESTO IS NULL)
		  )
		  THEN                 
			CASE 
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.ALTURA_CERCHAS
				)
			  WHEN G.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.ALTURA_CERCHAS
				)
			  ELSE 0
			END
		  ELSE
			CASE 
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO RESIDENCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.ALTURA_CERCHAS
				)
			  WHEN cu.GRUPO_USO_PRESUPUESTO = 'PRESUPUESTO COMERCIAL' THEN 
				(
				  SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
				  FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
				  INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
				  INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
				  WHERE CF.CODIGO_FICHA = v.ALTURA_CERCHAS
				)
			  ELSE 0
			END
		END AS TOTAL_ALTURA_CERCHAS,
		
        v.LOG, v.VETUSTEZ, v.CLASE_CONSTRUCCION, 
        v.BARRIO_IRRADIADOR, v.MANZANA_IRRADIADOR, 
        v.PREDIO_IRRADIADOR, v.CONSTRUCCION_IRRADIADOR, 
        v.RESTO_IRRADIADOR,
		uc.TOTAL_UNIDADES_VALIDAS,
		G.GRUPO_USO_PRESUPUESTO,
        uc.USOS_ORDENADOS,
        cu.USOS_CONCATENADOS,
        cu.CODIGO_USO_PREDOMINANTE,
        cu.GRUPO_USO_PRESUPUESTO as GRUPO_USO_PRESUPUESTO_1,
        uc.USOS_PREVALENTE,
        uc.TIENE_USO_ESPECIAL,
        uc.TIENE_USO_012,
        uc.MAX_AREA_USO_012,
        uc.MAX_PISOS_012,
        uc.TIENE_USO_020,
        uc.CLASE_CONSTRUCCION_020

    FROM predio p
    INNER JOIN act_dependencia_barrios a   ON p.CODIGO_BARRIO  = a.CODIGO_BARRIO

    INNER JOIN vista_calificacion v        ON p.CODIGO_BARRIO  = v.CODIGO_BARRIO 	AND 
											  p.CODIGO_MANZANA = v.CODIGO_MANZANA 	AND 
											  p.CODIGO_PREDIO  = v.CODIGO_PREDIO 	AND 
											  p.CODIGO_CONSTRUCCION = v.CODIGO_CONSTRUCCION AND 
											  p.CODIGO_RESTO = v.CODIGO_RESTO
											  
    INNER JOIN cargue_cartografia c        ON p.CODIGO_BARRIO  = c.CODIGO_BARRIO AND
                                              p.CODIGO_MANZANA = c.CODIGO_MANZANA AND
                                              p.CODIGO_PREDIO  = c.CODIGO_PREDIO  											  
											  

	INNER JOIN predio_identificador	pr     ON p.CODIGO_BARRIO  = pr.CODIGO_BARRIO 	AND 
											  p.CODIGO_MANZANA = pr.CODIGO_MANZANA 	AND
											  p.CODIGO_PREDIO  = pr.CODIGO_PREDIO 	AND
											  p.CODIGO_CONSTRUCCION = pr.CODIGO_CONSTRUCCION AND
											  p.CODIGO_RESTO = pr.CODIGO_RESTO
	
	INNER JOIN MR_TB_CLASIFICACION_USOS G ON G.CODIGO_USO = v.CODIGO_USO												
	
	INNER JOIN 
	(
		SELECT 
		v.CODIGO_BARRIO, v.CODIGO_MANZANA, v.CODIGO_PREDIO, v.CODIGO_CONSTRUCCION, v.CODIGO_RESTO,
		COUNT(DISTINCT v.CLASE_CONSTRUCCION || '-' || v.UNIDAD_CALIFICADA) AS TOTAL_UNIDADES_VALIDAS,
		LISTAGG(v.CODIGO_USO, ',' ON OVERFLOW TRUNCATE) WITHIN GROUP (ORDER BY v.AREA_USO DESC ,v.CODIGO_USO ASC) AS USOS_ORDENADOS,
		uso_prevalente_f (MAX(p.CODIGO_BARRIO),MAX(p.CODIGO_MANZANA), MAX(p.CODIGO_PREDIO),MAX(p.CODIGO_CONSTRUCCION),MAX(p.CODIGO_RESTO),NULL,NULL,NULL) AS USOS_PREVALENTE,
        MAX(CASE WHEN v.CODIGO_USO IN ('001', '002', '009') THEN 1 ELSE 0 END) AS TIENE_USO_ESPECIAL,
        MAX(CASE WHEN v.CODIGO_USO = '012' THEN 1 ELSE 0 END) AS TIENE_USO_012,
        MAX(CASE WHEN v.CODIGO_USO = '012' THEN v.AREA_USO ELSE 0 END) AS MAX_AREA_USO_012,
        MAX(CASE WHEN v.CODIGO_USO = '012' THEN c.MAX_NUM_PISOS ELSE 0 END) AS MAX_PISOS_012,
        MAX(CASE WHEN v.CODIGO_USO = '020' THEN 1 ELSE 0 END) AS TIENE_USO_020,
        MAX(CASE WHEN v.CODIGO_USO = '020' THEN v.CLASE_CONSTRUCCION ELSE NULL END) AS CLASE_CONSTRUCCION_020

		FROM predio p
		INNER JOIN act_dependencia_barrios a   ON p.CODIGO_BARRIO  = a.CODIGO_BARRIO
		INNER JOIN vista_calificacion v        ON p.CODIGO_BARRIO  = v.CODIGO_BARRIO 	AND 
												  p.CODIGO_MANZANA = v.CODIGO_MANZANA 	AND 
												  p.CODIGO_PREDIO  = v.CODIGO_PREDIO 	AND
												  p.CODIGO_CONSTRUCCION = v.CODIGO_CONSTRUCCION AND
												  p.CODIGO_RESTO = v.CODIGO_RESTO

        INNER JOIN cargue_cartografia c        ON p.CODIGO_BARRIO  = c.CODIGO_BARRIO AND
                                                  p.CODIGO_MANZANA = c.CODIGO_MANZANA AND
                                                  p.CODIGO_PREDIO  = c.CODIGO_PREDIO  											  

		WHERE 
			p.CLASE_PREDIO = 'N' AND 
			p.CONSERVACION_HISTORICA = 'N' AND 
			p.CODIGO_DESTINO <> '99' AND 
			(p.MARCA_FORMACION IS NULL OR p.MARCA_FORMACION <> 'S') AND
			p.AREA_CONSTRUIDA > 0 AND 
			v.CLASE_CONSTRUCCION IN ('R', 'C') AND 
			v.UNIDAD_CALIFICADA BETWEEN 'A' AND 'Z' AND -- v.codigo_barrio = '004110' and v.CODIGO_MANZANA = '01' and v.CODIGO_PREDIO = '07' 
			(v.CODIGO_BARRIO = p_barrio OR p_barrio IS NULL) AND 
			(v.CODIGO_MANZANA = p_manzana OR p_manzana IS NULL) AND 
			(v.CODIGO_PREDIO = p_predio OR p_predio IS NULL) AND 
			(v.CODIGO_CONSTRUCCION = p_construccion OR p_construccion IS NULL) AND 
			(v.CODIGO_RESTO = p_resto OR p_resto IS NULL)
		GROUP BY     
		v.CODIGO_BARRIO, v.CODIGO_MANZANA, v.CODIGO_PREDIO, v.CODIGO_CONSTRUCCION, v.CODIGO_RESTO 
	) uc													
	ON 	v.CODIGO_BARRIO  = uc.CODIGO_BARRIO  	AND 
		v.CODIGO_MANZANA = uc.CODIGO_MANZANA  	AND 
		v.CODIGO_PREDIO  = uc.CODIGO_PREDIO  	AND 
		v.CODIGO_CONSTRUCCION = uc.CODIGO_CONSTRUCCION  AND 
		v.CODIGO_RESTO = uc.CODIGO_RESTO 
    LEFT JOIN 
    (
        SELECT 
        CODIGO_USO_PREDOMINANTE,GRUPO_USO_PRESUPUESTO,
        CODIGO_USO_01 || ',' || CODIGO_USO_02 || 
        CASE 
            WHEN CODIGO_USO_03 IS NOT NULL THEN ',' || CODIGO_USO_03 
            ELSE '' 
        END AS USOS_CONCATENADOS
        FROM MR_TB_COMBINACION_USOS
    ) cu
    ON  uc.USOS_PREVALENTE = cu.CODIGO_USO_PREDOMINANTE AND cu.USOS_CONCATENADOS = uc.USOS_ORDENADOS  
	WHERE uc.TOTAL_UNIDADES_VALIDAS IN (2,3) --2 Y 3
	ORDER BY v.CODIGO_BARRIO,v.CODIGO_MANZANA,v.CODIGO_PREDIO,v.CODIGO_CONSTRUCCION,v.CODIGO_RESTO,v.AREA_USO DESC ;

END;

