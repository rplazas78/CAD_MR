/**********************************************************************      
$Archive  : PRC_REPORTE_COSTOS_CONSTRUCCION.sql
$Revision : $      
$Author   : CAD      
$Modtime  : $       
$History  : $   Metodo de Reposicion (MR)   
**********************************************************************/  

/*
SET SERVEROUTPUT ON;
SET FEEDBACK OFF;
SET VERIFY OFF;
SET HEADING ON;
SET UNDERLINE ON;
SET PAGESIZE 1000;
SET LINESIZE 15000;
SET TRIMSPOOL ON;
SET TERMOUT ON;
SET LONG 100000;
SET LONGCHUNKSIZE 100000;
CLEAR SCREEN;

--SET SERVEROUTPUT ON;
--CLEAR SCREEN;
VARIABLE emp_data REFCURSOR;
--EXECUTE PRC_REPORTE_COSTOS_CONSTRUCCION('004580', '11', '01', '000', '00000', :emp_data);;
EXECUTE PRC_REPORTE_COSTOS_CONSTRUCCION('004580', null, null, null, null, :emp_data);
PRINT :emp_data;
*/
--

CREATE OR REPLACE PROCEDURE PRC_REPORTE_COSTOS_CONSTRUCCION_1_4 
(
    p_barrio        IN VARCHAR2,
    p_manzana       IN VARCHAR2,
    p_predio        IN VARCHAR2,
    p_construccion  IN VARCHAR2,
    p_resto         IN VARCHAR2,
    p_resultado     OUT SYS_REFCURSOR
)
IS
BEGIN
    OPEN p_resultado FOR
    SELECT 
        v.CODIGO_BARRIO, v.CODIGO_MANZANA, v.CODIGO_PREDIO, v.CODIGO_CONSTRUCCION, v.CODIGO_RESTO,pr.CHIP, v.CODIGO_USO, v.UNIDAD_CALIFICADA, v.AREA_USO, 
        v.FECHA_CALIFICACION, v.ANO_CONSTRUCCION, v.PUNTAJE, v.PISOS, c.MAX_NUM_PISOS, v.AVANCE_CONSTRUCCION, v.NOMBRE_RESPONSABLE, v.IDENTIFICACION_RESPONSABLE, v.VALOR_UNIT_CONSTRUCCION, 
		
        v.ARMAZON_ESTRUCTURA,
        CASE 
            WHEN 
			(
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.ARMAZON_ESTRUCTURA
            )
            WHEN 
			(
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.ARMAZON_ESTRUCTURA
            )
            ELSE 0
        END AS TOTAL_ARMAZON_ESTRUCTURA,

        v.MUROS_ESTRUCTURA,
        CASE 
            WHEN 
			(
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.MUROS_ESTRUCTURA
            )
            WHEN 
			(
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.MUROS_ESTRUCTURA
            )
            ELSE 0
        END AS TOTAL_MUROS_ESTRUCTURA,

        v.CUBIERTA_ESTRUCTURA,
        CASE 
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.CUBIERTA_ESTRUCTURA
            )
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.CUBIERTA_ESTRUCTURA
            )
            ELSE 0
        END AS TOTAL_CUBIERTA_ESTRUCTURA,
		
        v.CONSERVACION_ESTRUCTURA,
        CASE 
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.CONSERVACION_ESTRUCTURA
            )
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.CONSERVACION_ESTRUCTURA
            )
            ELSE 0
        END AS TOTAL_CONSERVACION_ESTRUCTURA,

        v.FACHADA_ACABADOS,
        CASE 
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.FACHADA_ACABADOS
            )
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.FACHADA_ACABADOS
            )
            ELSE 0
        END AS TOTAL_FACHADA_ACABADOS,

        v.CUBIERTA_MUROS_ACABADOS,
        CASE 
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.CUBIERTA_MUROS_ACABADOS
            )
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.CUBIERTA_MUROS_ACABADOS
            )
            ELSE 0
        END AS TOTAL_CUBIERTA_MUROS_ACABADOS,
		
        v.PISOS_ACABADOS,
        CASE 
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.PISOS_ACABADOS
            )
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.PISOS_ACABADOS
            )
            ELSE 0
        END AS TOTAL_PISOS_ACABADOS,

        v.CONSERVACION_ACABADOS,
        CASE 
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.CONSERVACION_ACABADOS
            )
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.CONSERVACION_ACABADOS
            )
            ELSE 0
        END AS TOTAL_CONSERVACION_ACABADOS,

        v.TAMANO_BANO,
        CASE 
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.TAMANO_BANO
            )
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.TAMANO_BANO
            )
            ELSE 0
        END AS TOTAL_TAMANO_BANO,

        v.ENCHAPE_BANO,
        CASE 
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.ENCHAPE_BANO
            )
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.ENCHAPE_BANO
            )
            ELSE 0
        END AS TOTAL_ENCHAPE_BANO,


        v.MOBILIARIO_BANO,
        CASE 
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.MOBILIARIO_BANO
            )
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.MOBILIARIO_BANO
            )
            ELSE 0
        END AS TOTAL_MOBILIARIO_BANO,

        v.CONSERVACION_BANO,
        CASE 
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.CONSERVACION_BANO
            )
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.CONSERVACION_BANO
            )
            ELSE 0
        END AS TOTAL_CONSERVACION_BANO,


        v.TAMANO_COCINA,
        CASE 
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.TAMANO_COCINA
            )
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.TAMANO_COCINA
            )
            ELSE 0
        END AS TOTAL_TAMANO_COCINA,

        v.ENCHAPE_COCINA,
        CASE 
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.ENCHAPE_COCINA
            )
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.ENCHAPE_COCINA
            )
            ELSE 0
        END AS TOTAL_ENCHAPE_COCINA,

        v.MOBILIARIO_COCINA,
        CASE 
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.MOBILIARIO_COCINA
            )
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.MOBILIARIO_COCINA
            )
            ELSE 0
        END AS TOTAL_MOBILIARIO_COCINA,
		
        v.CONSERVACION_COCINA,
        CASE 
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.CONSERVACION_COCINA
            )
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.CONSERVACION_COCINA
            )
            ELSE 0
        END AS TOTAL_CONSERVACION_COCINA,		
		
        v.COMPLEMENTO_INDUSTRIA,
        CASE 
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.COMPLEMENTO_INDUSTRIA
            )
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.COMPLEMENTO_INDUSTRIA
            )
            ELSE 0
        END AS TOTAL_COMPLEMENTO_INDUSTRIA,


        v.ALTURA_CERCHAS,
        CASE 
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO RESIDENCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_RES CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.ALTURA_CERCHAS
            )
            WHEN (
                CASE 
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.AREA_USO <= 350 AND c.MAX_NUM_PISOS <= 5 THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '012' AND uc.TOTAL_UNIDADES_VALIDAS = 1 THEN 'PRESUPUESTO COMERCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'R' THEN 'PRESUPUESTO RESIDENCIAL'
                    WHEN v.CODIGO_USO = '020' AND uc.TOTAL_UNIDADES_VALIDAS = 1 AND v.CLASE_CONSTRUCCION = 'C' THEN 'PRESUPUESTO COMERCIAL'
                    ELSE G.GRUPO_USO_PRESUPUESTO
                END
            ) = 'PRESUPUESTO COMERCIAL' THEN 
            (
                SELECT SUM(LM.COSTO_UNITARIO_MATERIAL * AOM.CANTIDAD_MATERIAL)
                FROM MR_TB_LISTADO_MATERIAL_MANO_OBRA LM
                INNER JOIN MR_TB_ACTIVIDAD_OBRA_MATERIAL AOM ON LM.ID_MATERIAL = AOM.ID_MATERIAL
                INNER JOIN MR_TB_ACT_OBR_COD_FICHA_COM CF ON AOM.ID_ACTIVIDAD_OBRA = CF.ID_ACTIVIDAD_OBRA
                WHERE CF.CODIGO_FICHA = v.ALTURA_CERCHAS
            )
            ELSE 0
        END AS TOTAL_ALTURA_CERCHAS,
		
        v.LOG, v.VETUSTEZ, v.CLASE_CONSTRUCCION, 
        v.BARRIO_IRRADIADOR, v.MANZANA_IRRADIADOR, 
        v.PREDIO_IRRADIADOR, v.CONSTRUCCION_IRRADIADOR, 
        v.RESTO_IRRADIADOR,
		uc.TOTAL_UNIDADES_VALIDAS,
		G.GRUPO_USO_PRESUPUESTO,
        NULL USOS_ORDENADOS,
        NULL USOS_CONCATENADOS,
        NULL CODIGO_USO_PREDOMINANTE,
        NULL GRUPO_USO_PRESUPUESTO_1,
        NULL USOS_PREVALENTE,
        NULL TIENE_USO_ESPECIAL,
        NULL TIENE_USO_012,
        NULL MAX_AREA_USO_012,
        NULL MAX_PISOS_012,
        NULL TIENE_USO_020,
        NULL CLASE_CONSTRUCCION_020		

    FROM predio p
    INNER JOIN act_dependencia_barrios a   ON p.CODIGO_BARRIO  = a.CODIGO_BARRIO

    INNER JOIN vista_calificacion v        ON p.CODIGO_BARRIO  = v.CODIGO_BARRIO 	AND 
											  p.CODIGO_MANZANA = v.CODIGO_MANZANA 	AND 
											  p.CODIGO_PREDIO  = v.CODIGO_PREDIO 	AND 
											  p.CODIGO_CONSTRUCCION = v.CODIGO_CONSTRUCCION AND 
											  p.CODIGO_RESTO = v.CODIGO_RESTO
											  
    INNER JOIN cargue_cartografia c        ON p.CODIGO_BARRIO  = c.CODIGO_BARRIO AND
                                              p.CODIGO_MANZANA = c.CODIGO_MANZANA AND
                                              p.CODIGO_PREDIO  = c.CODIGO_PREDIO  											  
											  

	INNER JOIN predio_identificador	pr     ON p.CODIGO_BARRIO  = pr.CODIGO_BARRIO 	AND 
											  p.CODIGO_MANZANA = pr.CODIGO_MANZANA 	AND
											  p.CODIGO_PREDIO  = pr.CODIGO_PREDIO 	AND
											  p.CODIGO_CONSTRUCCION = pr.CODIGO_CONSTRUCCION AND
											  p.CODIGO_RESTO = pr.CODIGO_RESTO
	
	INNER JOIN MR_TB_CLASIFICACION_USOS G ON G.CODIGO_USO = v.CODIGO_USO												
	
	INNER JOIN 
	(
		SELECT 
		v.CODIGO_BARRIO, v.CODIGO_MANZANA, v.CODIGO_PREDIO, v.CODIGO_CONSTRUCCION, v.CODIGO_RESTO,
		COUNT(DISTINCT v.CLASE_CONSTRUCCION || '-' || v.UNIDAD_CALIFICADA) AS TOTAL_UNIDADES_VALIDAS
		FROM predio p
		INNER JOIN act_dependencia_barrios a   ON p.CODIGO_BARRIO  = a.CODIGO_BARRIO
		INNER JOIN vista_calificacion v        ON p.CODIGO_BARRIO  = v.CODIGO_BARRIO 	AND 
												  p.CODIGO_MANZANA = v.CODIGO_MANZANA 	AND 
												  p.CODIGO_PREDIO  = v.CODIGO_PREDIO 	AND
												  p.CODIGO_CONSTRUCCION = v.CODIGO_CONSTRUCCION AND
												  p.CODIGO_RESTO = v.CODIGO_RESTO
		WHERE 
			p.CLASE_PREDIO = 'N' AND 
			p.CONSERVACION_HISTORICA = 'N' AND 
			p.CODIGO_DESTINO <> '99' AND 
			(p.MARCA_FORMACION IS NULL OR p.MARCA_FORMACION <> 'S') AND
			p.AREA_CONSTRUIDA > 0 AND 
			v.CLASE_CONSTRUCCION IN ('R', 'C') AND 
			v.UNIDAD_CALIFICADA BETWEEN 'A' AND 'Z' AND -- v.codigo_barrio = '004110' 
			(v.CODIGO_BARRIO = p_barrio OR p_barrio IS NULL) AND 
			(v.CODIGO_MANZANA = p_manzana OR p_manzana IS NULL) AND 
			(v.CODIGO_PREDIO = p_predio OR p_predio IS NULL) AND 
			(v.CODIGO_CONSTRUCCION = p_construccion OR p_construccion IS NULL) AND 
			(v.CODIGO_RESTO = p_resto OR p_resto IS NULL)
		GROUP BY     
		v.CODIGO_BARRIO, v.CODIGO_MANZANA, v.CODIGO_PREDIO, v.CODIGO_CONSTRUCCION, v.CODIGO_RESTO 
	) uc													
	ON 	v.CODIGO_BARRIO  = uc.CODIGO_BARRIO  	AND 
		v.CODIGO_MANZANA = uc.CODIGO_MANZANA  	AND 
		v.CODIGO_PREDIO  = uc.CODIGO_PREDIO  	AND 
		v.CODIGO_CONSTRUCCION = uc.CODIGO_CONSTRUCCION  AND 
		v.CODIGO_RESTO = uc.CODIGO_RESTO 
	   WHERE uc.TOTAL_UNIDADES_VALIDAS NOT IN (2,3) --1 Y >= 4
	ORDER BY v.CODIGO_BARRIO,v.CODIGO_MANZANA,v.CODIGO_PREDIO,v.CODIGO_CONSTRUCCION,v.CODIGO_RESTO;
END;

